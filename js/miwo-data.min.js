!function(){var t={}.hasOwnProperty,e=function(e,r){function o(){this.constructor=e}for(var i in r)t.call(r,i)&&(e[i]=r[i]);return o.prototype=r.prototype,e.prototype=new o,e.__super__=r.prototype,e};!function r(t,e,o){function i(s,a){if(!e[s]){if(!t[s]){var p="function"==typeof require&&require;if(!a&&p)return p(s,!0);if(n)return n(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=e[s]={exports:{}};t[s][0].call(c.exports,function(e){var r=t[s][1][e];return i(r?r:e)},c,c.exports,r,t,e,o)}return e[s].exports}for(var n="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(t,e){var r;r=function(){function t(){this.types={},this.items={}}return t.prototype.types=null,t.prototype.items=null,t.prototype.define=function(t,e){if(!Type.isFunction(e))throw new Error("Bad defined type '"+t+"' in '"+this+"'. Class is not function");return this.types[t]=e,this},t.prototype.register=function(t,e){return this.items[t]=e,this},t.prototype.unregister=function(t){return delete this.items[t],this},t.prototype.has=function(t){return void 0!==this.items[t]},t.prototype.get=function(t){return this.items[t]||this.register(t,this.create(t)),this.items[t]},t.prototype.create=function(t,e){if(!this.types[t])throw new Error("Undefined type '"+t+"' in "+this);return new this.types[t](e)},t.prototype.toString=function(){return this.constructor.name},t}(),e.exports=r},{}],2:[function(t,r){var o,i,n,s;s=t("./StoreManager"),n=t("./ProxyManager"),i=t("./EntityManager"),o=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.init=function(){this.setConfig({stores:{},entities:{}})},r.prototype.build=function(t){var e;e=window[t.params.namespace],e.entity||(e.entity={}),e.store||(e.store={}),t.define("storeMgr",s,function(t){return function(r){var o,i,n;n=t.config.stores;for(o in n)i=n[o],r.define(o,i),e.store[o.capitalize()]=i}}(this)),t.define("entityMgr",i,function(t){return function(r){var o,i,n;n=t.config.entities;for(i in n)o=n[i],r.define(i,o),e.entity[i.capitalize()]=o}}(this)),t.define("proxyMgr",n,function(t){return function(e){var r,o,i;i=t.config.entities;for(o in i)r=i[o],r.proxy&&(e.define(o,r.proxy),r.proxy=o)}}(this))},r}(Miwo.di.InjectorExtension),r.exports=o},{"./EntityManager":4,"./ProxyManager":8,"./StoreManager":13}],3:[function(t,r){var o,i,n,s;n=t("./Record"),s=t("./Store"),i=t("./EntityManager"),o=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.collections=null,r.prototype.entities=null,r.collection=function(t,e){var r,o;if(this.prototype[t])throw new Error("Property "+t+" is already defined. Please use other collection name");this.prototype._collections||(this.prototype._collections={}),this.prototype._collections[t]=e,Object.defineProperty(this.prototype,t,{get:function(){return this.getCollection(t)}}),r=this.prototype.constructor.name,o=e.type.prototype,o._entities||(o._entities={}),o._entities[r]={type:this.prototype.constructor},o["get"+r.capitalize()]=function(t){this.getEntity(r,t)}},r.prototype.setup=function(t){var e,o,i,n,a,p;if(r.__super__.setup.call(this,t),this._collections){this.collections={},a=this._collections;for(i in a)o=a[i],this.collections[i]=new s({entity:o.type});p=this.collections;for(i in p)e=p[i],n=t[i]||[],e.loadData(n)}},r.prototype.copy=function(t){r.__super__.copy.call(this,t)},r.prototype.getCollection=function(t){return this.collections[t]},r.prototype.getEntity=function(t,e){this.entities||(this.entities={}),this.entities[t]||(this.entities[t]=new this._entities[t].type),this.entities[t].load(this.get(t+"Id"),e)},r.prototype.save=function(t){i.save(this,t)},r}(n),r.exports=o},{"./EntityManager":4,"./Record":9,"./Store":11}],4:[function(t,r){var o,i;o=t("./BaseManager"),i=function(r){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,r),o.prototype.proxyKlass=null,o.prototype.setProxy=function(t){return this.proxyKlass=t,this},o.prototype.get=function(t){return this.items[t]},o.prototype.load=function(){},o.prototype.save=function(){},o.prototype.create=function(t,e){var r;if(Type.isString(t))r=o.__super__.create.call(this,t,e);else{if(!Type.isFunction(t))throw new Error("Cant create entity, parameter name must by string or function, you put: "+typeof t);r=new t(e)}return r},o.prototype.createEntityClass=function(r){var o,i,n,s,a;o=t("./Entity"),i=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.prototype.idProperty=r.idProperty,o}(o),a=r.fields;for(n in a)s=a[n],i.field(n,s);return i},o}(o),r.exports=i},{"./BaseManager":1,"./Entity":3}],5:[function(t,r){var o;o=function(t){function r(t){r.__super__.constructor.call(this,t),("in"===this.operation||"!in"===this.operation)&&(this.value=this.value.split(","))}return e(r,t),r.prototype.name=null,r.prototype.type="string",r.prototype.operation="=",r.prototype.value=null,r.prototype.params=null,r.prototype.match=function(t){var e;if("callback"===this.type)return this.operation(t,this.value);if("string"===this.type){switch(e=t.get(this.name),this.operation){case"=":return e===this.value;case"!=":return e!==this.value;case"in":return this.value.indexOf(e)>=0;case"!in":return this.value.indexOf(e)<0;case"!empty":return!!e;case"empty":return!e}return!1}return null},r.prototype.toData=function(){return{name:this.name,value:this.value,type:this.type,operation:this.operation,params:JSON.encode(this.params)}},r}(Miwo.Object),r.exports=o},{}],6:[function(t,r){var o,i;i=t("./Record"),o=function(t){function r(t){r.__super__.constructor.call(this,t),this.createRecord=t.recordFactory?t.recordFactory:function(t){return new i(t)}}return e(r,t),r.prototype.async=void 0,r.prototype.action=void 0,r.prototype.filters=void 0,r.prototype.sorters=void 0,r.prototype.offset=void 0,r.prototype.limit=void 0,r.prototype.params=void 0,r.prototype.callback=void 0,r.prototype.started=!1,r.prototype.running=!1,r.prototype.complete=!1,r.prototype.success=void 0,r.prototype.exception=!1,r.prototype.error=void 0,r.prototype.code=void 0,r.prototype.records=void 0,r.prototype.response=void 0,r.prototype.createRecord=void 0,r.prototype.setRecordFactory=function(t){this.createRecord=t},r.prototype.getResponse=function(){return this.response},r.prototype.getRecords=function(){return this.records},r.prototype.getRecord=function(){return this.records&&this.records.length>0?this.records[0]:null},r.prototype.setCompleted=function(){this.complete=!0,this.running=!1},r.prototype.setSuccessful=function(){this.success=!0},r.prototype.setException=function(t,e){this.exception=!0,this.success=!1,this.running=!1,this.error=t,this.code=e},r.prototype.hasException=function(){return this.exception===!0},r.prototype.getError=function(){return this.error},r.prototype.getCode=function(){return this.code},r.prototype.isStarted=function(){return this.started===!0},r.prototype.isRunning=function(){return this.running===!0},r.prototype.isComplete=function(){return this.complete===!0},r.prototype.wasSuccessful=function(){return this.isComplete()&&this.success===!0},r}(Miwo.Object),r.exports=o},{"./Record":9}],7:[function(t,r){var o,i;o=t("./Operation"),i=function(t){function r(t){this.defaults={timeout:0,async:!0},this.api={create:void 0,read:void 0,update:void 0,destroy:void 0},t.url&&(this.api.read=this.url,delete t.url),r.__super__.constructor.call(this,t)}return e(r,t),r.prototype.isProxy=!0,r.prototype.name=void 0,r.prototype.headers=null,r.prototype.secure=!0,r.prototype.defaults=null,r.prototype.api=null,r.prototype.setAsync=function(t){this.defaults.async=t},r.prototype.execute=function(t,e){t.destroy&&(e.records=t.destroy.records,this.destroy(e,t.destroy.callback)),t.create&&(e.records=t.create.records,this.create(e,t.create.callback)),t.update&&(e.records=t.update.records,this.update(e,t.update.callback))},r.prototype.read=function(t,e){this.doRequest(this.createOperation("read",t),e)},r.prototype.create=function(t,e){this.doRequest(this.createOperation("create",t),e)},r.prototype.update=function(t,e){this.doRequest(this.createOperation("update",t),e)},r.prototype.destroy=function(t,e){this.doRequest(this.createOperation("destroy",t),e)},r.prototype.createOperation=function(t,e){var r,i,n,s,a,p;if(n=[],e.records)for(p=e.records,s=0,a=p.length;a>s;s++)i=p[s],n.push(i);return e.records=n,r=new o(e),r.action=t,r},r.prototype.doRequest=function(t,e){var r,o;o=miwo.http.createRequest(),r=Object.merge({},this.defaults),r.method="POST",r.headers=this.headers,r.url=this.api[t.action],r.data=this.createRequestData(t),r.onComplete=function(){t.setCompleted()},r.onRequest=function(){t.running=!0},r.onSuccess=function(r){return function(i){r.processResponse(!0,t,o,i,e)}}(this),r.onFailure=function(r){return function(){r.processResponse(!1,t,o,null,e)}}(this),void 0!==t.async&&(r.async=t.async),t.started=!0,o.setOptions(r),o.send()},r.prototype.createRequestData=function(t){var e;switch(e={},e.action=t.action,t.action){case"create":e.data=this.createOperationData(t,"create");break;case"destroy":e.data=this.createOperationData(t,"destroy");break;case"update":e.data=this.createOperationData(t,"update");break;case"read":t.filters&&(e.filters=this.createItemsData(t.filters)),t.sorters&&(e.sorters=this.createItemsData(t.sorters)),t.offset&&(e.offset=t.offset),t.limit&&(e.limit=t.limit),t.params&&Object.expand(e,t.params)}return e},r.prototype.createItemsData=function(t){var e,r,o,i;for(e=[],o=0,i=t.length;i>o;o++)r=t[o],e.push(r.toData());return e},r.prototype.createOperationData=function(t,e){var r,o,i,n,s,a;if(!t.getRecords())throw new Error("operation has no records");for(o=[],a=t.getRecords(),n=0,s=a.length;s>n;n++)i=a[n],"create"===e?o.push(i.getValues()):"update"===e?(r=i.getChanges(),r[i.idProperty]=i.getId(),o.push(r)):"destroy"===e&&o.push(i.getId());return JSON.encode(o)},r.prototype.processResponse=function(t,e,r,o,i){var n;t?o.success?(e.setSuccessful(),e.response=o,this.commitOperation(e,o.records)):e.setException(o.error,o.code):(n=r.xhr,e.setException(n.responseText,n.status)),i(e)},r.prototype.commitOperation=function(t,e){var r,o,i,n,s,a,p,c,h,u,d,l;switch(t.action){case"create":for(o=n=0,c=e.length;c>n;o=++n)r=e[o],i=t.records[o],i.set(r),i.commit();break;case"update":for(s=0,h=e.length;h>s;s++)for(r=e[s],l=t.records,a=0,u=l.length;u>a;a++)if(i=l[a],i.getId()===r.id){i.set(r),i.commit();break}break;case"read":for(t.records=[],p=0,d=e.length;d>p;p++)r=e[p],i=t.createRecord(r),t.records.push(i)}},r}(Miwo.Object),r.exports=i},{"./Operation":6}],8:[function(t,r){var o,i,n;o=t("./BaseManager"),i=t("./Proxy"),n=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.define=function(t,e){if(!Type.isFunction(e)&&!Type.isObject(e))throw new Error("Bad defined type '"+t+"' in '"+this+"'. Parameter should by function or object");return this.types[t]=e,this},r.prototype.create=function(t){if(!this.types[t])throw new Error("Undefined type '"+t+"' in "+this);return this.createProxy(this.types[t])},r.prototype.createProxy=function(t){var e;if(Type.isFunction(t)&&(e=new t),Type.isObject(t)&&(e=new i(t)),!e.isProxy)throw new Error("Created proxy is not instance of Miwo.data.Proxy");return e},r}(o),r.exports=n},{"./BaseManager":1,"./Proxy":7}],9:[function(t,r){var o,i,n=[].slice;i=t("./Types"),o=function(t){function r(t,e){null==t&&(t={}),null==e&&(e=null),this._data={},this._stores=[],this._raw=t,this.fields={},e?this.copy(e):this.setup(t),this._modified={},this._dirty=!1,this._phantom=!(this.getId()||0===this.getId()),this.init()}return e(r,t),r.prototype.isRecord=!0,r.prototype.idProperty="id",r.prototype._phantom=!1,r.prototype._editing=!1,r.prototype._dirty=!1,r.prototype._data=null,r.prototype._modified=null,r.prototype._stores=null,r.prototype._store=null,r.prototype._raw=null,r.prototype.fields=null,r.prototype._singleProp={},r.getter("phantom",function(){return this._phantom}),r.field=function(t,e){if(this.prototype[t])throw new Error("Property "+t+" is already used. Please use other field name");this.prototype._fields||(this.prototype._fields={}),this.prototype._fields[t]=e,Object.defineProperty(this.prototype,t,{get:function(){return this.get(t)},set:function(e){return this.set(t,e)}})},r.prototype.init=function(){},r.prototype.setup=function(t){var e,r,o,n,s,a;s=this._fields;for(r in s){if(e=s[r],o=e.type||"string",!i[o])throw new Error("Record::initialize(): undefined type "+o);this.fields[r]=Object.merge({},i[o],{name:r,def:void 0!==e.def?e.def:null,nullable:void 0!==e.nullable?e.nullable:null,persist:void 0!==e.persist?e.persist:!0})}a=this.fields;for(r in a)e=a[r],n=t[r],void 0===n&&(n=e.def),e.convert&&(n=e.convert(n,this)),void 0!==n&&(this._data[r]=n,this.onValueChanged(r,n,null))},r.prototype.copy=function(t){this.fields=t.fields,this._data=t.data},r.prototype.clone=function(t){var e;return e=Object.merge({},{fields:this.fields,data:this._data}),e.data[this.idProperty]=t,new this.constructor(this._raw,e)},r.prototype.get=function(t){var e;return e="get"+t.capitalize(),this[e]?this[e]():this._data[t]},r.prototype.set=function(t,e){var r,o,i,n,s,a,p,c,h,u;c=Type.isString(t),c?(u=this._singleProp,u[t]=e):u=t;for(s in u)h=u[s],this.fields[s]&&(o=this.fields[s],o.convert&&(h=o.convert(h,this)),r=this._data[s],this.isEqual(r,h)||(this._data[s]=h,this.onValueChanged(s,h,r),(n||(n=[])).push(s),o.persist&&(this._modified[s]?this.isEqual(this._modified[s],h)&&(delete this._modified[s],this._dirty=Object.getLength(this._modified)>0):(this._dirty=!0,this._modified[s]=r)),s===this.idProperty&&(i=!0,p=r,a=h)));return c&&delete u[t],i&&this.emit("idchanged",this,p,a),!this._editing&&n&&this.afterEdit(n),n||null},r.prototype.getId=function(){return this._data[this.idProperty]},r.prototype.setId=function(t){this.set(this.idProperty,t),this._phantom=!(t||0===t)},r.prototype.updating=function(t){var e;e=this._editing,e||this.beginEdit(),t(this._data),e||this.endEdit()},r.prototype.getValues=function(){var t,e,r,o;r={},o=this.fields;for(e in o)t=o[e],r[e]=this.get(e);return r},r.prototype.beginEdit=function(){var t,e,r,o;if(!this._editing){this._editing=!0,this._dirtySaved=this._dirty,this._dataSaved={},this._modifiedSaved={},r=this._data;for(t in r)e=r[t],this._dataSaved[t]=e;o=this._modified;for(t in o)e=o[t],this._modifiedSaved[t]=e}},r.prototype.cancelEdit=function(){this._editing&&(this._editing=!1,this._dirty=this._dirtySaved,this._data=this._dataSaved,this._modified=this._modifiedSaved,delete this._dirtySaved,delete this._dataSaved,delete this._modifiedSaved)},r.prototype.endEdit=function(t,e){var r,o;this._editing&&(this._editing=!1,o=this._dataSaved,delete this._modifiedSaved,delete this._dataSaved,delete this._dirtySaved,t||(e||(e=this.getModifiedFieldNames(o)),r=this._dirty||e.length>0,r&&this.afterEdit(e)))},r.prototype.getModifiedFieldNames=function(t){var e,r,o,i;r=[],i=this._data;for(e in i)o=i[e],this.isEqual(o,t[e])||r.push(e);return r},r.prototype.getChanges=function(){var t,e,r,o;t={},o=this._modified;for(e in o)r=o[e],t[e]=this.get(e);return t},r.prototype.isModified=function(t){return this._modified.hasOwnProperty(t)},r.prototype.isEqual=function(t,e){var r;if(Type.isObject(t)&&Type.isObject(e)){if(Object.getLength(t)!==Object.getLength(e))return!1;for(r in t)if(e[r]!==t[r])return!1;return!0}return Type.isDate(t)&&Type.isDate(e)?t.getTime()===e.getTime():t===e},r.prototype.setDirty=function(){var t,e,r;this._dirty=!0,r=this.fields;for(e in r)t=r[e],t.persist&&(this._modified[e]=this.get(e))},r.prototype.reject=function(t){var e,r,o;null==t&&(t=!1),o=this._modified;for(e in o)r=o[e],this._data[e]=r;this._dirty=!1,this._editing=!1,this._modified={},t||this.afterReject()},r.prototype.commit=function(t){null==t&&(t=!1),this._phantom=this._dirty=this._editing=!1,this._modified={},t||this.afterCommit()},r.prototype.joinStore=function(t){this._stores.include(t),this._store=this._stores[0]},r.prototype.unjoinStore=function(t){this._stores.erase(t),this._store=this._stores[0]||null},r.prototype.isStored=function(){return null!==this._store},r.prototype.isPhantom=function(){return this._phantom},r.prototype.afterEdit=function(t){this.emit("edit",this,t),this.callStore("afterEdit",this,t)},r.prototype.afterReject=function(){this.callStore("afterReject",this)},r.prototype.afterCommit=function(){this.callStore("afterCommit",this)},r.prototype.callStore=function(){var t,e,r,o,i,s;for(e=arguments[0],t=2<=arguments.length?n.call(arguments,1):[],s=this._stores,o=0,i=s.length;i>o;o++)r=s[o],r[e]&&r[e].apply(r,t)},r.prototype.onValueChanged=function(){},r}(Miwo.Events),r.exports=o},{"./Types":15}],10:[function(t,r){var o;o=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.name=null,r.prototype.dir=null,r.prototype.compare=function(t,e){var r,o,i;if(Type.isFunction(this.dir))return this.dir(t,e);if(r=t.get(this.name),o=e.get(this.name),i="desc"===this.dir?-1:1,Type.isDate(r)&&Type.isDate(o)){if(r-o>0)return i;if(0>r-o)return-i}else{if(r>o)return i;if(o>r)return-i}return null},r.prototype.toData=function(){return{name:this.name,dir:this.dir}},r}(Miwo.Object),r.exports=o},{}],11:[function(t,r){var o,i,n;i=t("./StoreFilters"),n=t("./StoreSorters"),o=function(t){function r(t){var e;if(null==t&&(t={}),r.__super__.constructor.call(this,t),this.newRecords=[],this.removedRecords=[],this.updatedRecords=[],t.entity&&(this.entity=t.entity),!this.entity&&this.fields&&(this.entity=miwo.entityMgr.createEntityClass({fields:this.fields,idProperty:this.idProperty}),delete this.fields,delete this.idProperty),!this.entity)throw new Error("Unspecified entity or fields for store "+this);!this.proxy&&this.api&&(this.proxy={api:this.api},delete this.api),this.proxy||this.api?(e=miwo.proxyMgr,Type.isString(this.proxy)?this.proxy=e.get(this.proxy):Type.isObject(this.proxy)&&(this.proxy=e.createProxy(this.proxy))):this.entity.proxy&&(e=miwo.proxyMgr,Type.isString(this.entity.proxy)?this.proxy=e.get(this.entity.proxy):Type.isObject(this.entity.proxy)&&(this.proxy=e.createProxy(this.entity.proxy))),this.name&&(miwo.storeMgr.has(this.name)||miwo.storeMgr.register(this.name,this)),this.sort&&this.getSorters().set(this.sort),this.filter&&this.getFilters().set(this.filter),this.data=[],this.init(),this.autoLoad&&this.load()}return e(r,t),r.prototype.isStore=!0,r.prototype.name=null,r.prototype.entity=null,r.prototype.fields=null,r.prototype.idProperty="id",r.prototype.data=null,r.prototype.newRecords=null,r.prototype.removedRecords=null,r.prototype.updatedRecords=null,r.prototype.autoLoad=!1,r.prototype.autoSync=!1,r.prototype.autoSyncReload=!1,r.prototype.autoSyncSuspended=!1,r.prototype.remoteFilter=!1,r.prototype.remoteSort=!1,r.prototype.proxy=null,r.prototype.storeFilters=null,r.prototype.filteredData=null,r.prototype.filterOnLoad=!0,r.prototype.filterOnEdit=!0,r.prototype.filtered=!1,r.prototype.filter=null,r.getter("filters",function(){return this.getFilters()}),r.prototype.storeSorters=null,r.prototype.sortOnLoad=!0,r.prototype.sortOnEdit=!0,r.prototype.sort=null,r.getter("sorters",function(){return this.getSorters()}),r.prototype.pageSize=null,r.prototype.loading=!1,r.prototype.loaded=!1,r.prototype.totalCount=0,r.prototype.page=1,r.prototype.params=null,r.prototype.init=function(){},r.prototype.getAll=function(){return this.data},r.prototype.getLast=function(){return this.data.getLast()},r.prototype.getFirst=function(){return this.data[0]},r.prototype.getCount=function(){return this.data.length},r.prototype.getAt=function(t){return t<this.data.length?this.data[t]:null},r.prototype.getById=function(t){var e,r,o,i;for(i=this.data,r=0,o=i.length;o>r;r++)if(e=i[r],e.id==t)return e;return null},r.prototype.attachRecord=function(t){t.joinStore(this)},r.prototype.detachRecord=function(t){t.unjoinStore(this)},r.prototype.isLoading=function(){return this.loading},r.prototype.isFiltered=function(){return this.filtered},r.prototype.getTotalCount=function(){return this.totalCount},r.prototype.getModifiedRecords=function(){return[].concat(this.getNewRecords(),this.getUpdatedRecords())},r.prototype.getNewRecords=function(){return this.newRecords},r.prototype.getRemovedRecords=function(){return this.removedRecords},r.prototype.getUpdatedRecords=function(){return this.updatedRecords},r.prototype.getRecords=function(){return this.filtered?this.filteredData:this.data},r.prototype.each=function(t){this.data.each(t)},r.prototype.loadRecords=function(t,e){var r,o,i;for(null==e&&(e=!1),e&&this.clear(),o=0,i=t.length;i>o;o++)r=t[o],this.data.push(r),this.attachRecord(r);this.sortOnLoad&&!this.remoteSort&&this.storeSorters&&this.storeSorters.has()&&this.storeSorters.apply(!0),this.filterOnLoad&&!this.remoteFilter&&this.storeFilters&&this.storeFilters.has()&&this.storeFilters.apply(!0),this.emit("datachanged",this)},r.prototype.setData=function(t,e){var r,o,i,n;for(r=[],i=0,n=t.length;n>i;i++)o=t[i],r.push(this.createRecord(o));this.loadRecords(r,e),this.emit("load",this,r)},r.prototype.createRecord=function(t){return miwo.entityMgr.create(this.entity,t)},r.prototype.setProxy=function(t){this.proxy=t},r.prototype.getProxy=function(){return this.proxy},r.prototype.indexOf=function(t,e){var r,o,i,n,s;for(i=!e||e&&!this.filtered?this.data:this.filteredData,r=n=0,s=i.length;s>n;r=++n)if(o=i[r],o===t)return r;return null},r.prototype.indexOfId=function(t){var e,r,o,i,n;for(n=this.data,e=o=0,i=n.length;i>o;e=++o)if(r=n[e],r.getId()===t)return e;return null},r.prototype.findAtBy=function(t){var e,r,o,i,n;for(n=this.data,e=o=0,i=n.length;i>o;e=++o)if(r=n[e],t(r,e))return e;return null},r.prototype.findAtRecord=function(t,e,r,o){return this.findAtBy(this.createFinderCallback(t,e,r,o))},r.prototype.findAtExact=function(t,e,r){return this.findAtRecord(t,e,"===",r)},r.prototype.findBy=function(t){var e,r,o,i;for(i=this.data,r=0,o=i.length;o>r;r++)if(e=i[r],t(e))return e;return null},r.prototype.findRecord=function(t,e,r,o){return this.findBy(this.createFinderCallback(t,e,r,o))},r.prototype.findExact=function(t,e,r){return this.findRecord(t,e,"===",r)},r.prototype.findAllBy=function(t){var e,r,o,i,n;for(e=[],n=this.data,o=0,i=n.length;i>o;o++)r=n[o],t(r)&&e.push(r);return e},r.prototype.findAllAt=function(t,e){var r,o,i,n,s,a,p;for(null==e&&(e=1),i=t+e,r=[],p=this.data,o=s=0,a=p.length;a>s;o=++s)n=p[o],o>=t&&i>o&&r.push(n);return r},r.prototype.findRecords=function(t,e,r,o){return this.findAllBy(this.createFinderCallback(t,e,r,o))},r.prototype.createFinderCallback=function(t,e,r,o){return null==r&&(r="?"),null==o&&(o=null),function(){return function(i,n){var s;if(null===o||n>=o)switch(s=i.get(t),r){case"===":if(s===e)return!0;break;case"==":if(s===e)return!0;break;case"=":if(s.toString().test(e))return!0;break;case"?":if(s.toString().test(e,"i"))return!0;break;default:throw new Error("Unknown operator "+r)}return!1}}(this)},r.prototype.add=function(t){var e,r,o,i;if(t=Array.from(t),e=!1,0!==t.length){for(o=0,i=t.length;i>o;o++)r=t[o],e=!0,this.data.push(r),this.newRecords.push(r),this.removedRecords.erase(r),this.filtered&&this.getFilters().match(r)&&this.filteredData.push(r),this.attachRecord(r),this.emit("add",this,r);return e&&this.emit("datachanged",this),this}},r.prototype.insert=function(t,e,r){var o,i,n,s,a;if(e=Array.from(e),0!==e.length){for(o=s=0,a=e.length;a>s;o=++s)n=e[o],i=r?0:t+o,this.data.insert(i,n),this.newRecords.push(n),this.removedRecords.erase(n),this.filtered&&this.getFilters().match(n)&&this.filteredData.push(n),this.attachRecord(n),this.emit("add",this,n,i);return this.emit("datachanged",this),this}},r.prototype.addSorted=function(t){var e;return e=this.storeSorters?this.storeSorters.getIndex(t):this.data.length,this.insert(e,t),t},r.prototype.addData=function(t){var e,r,o,i;if(Type.isArray(t)){for(r=[],o=0,i=t.length;i>o;o++)e=t[o],r.push(this.createRecord(e));this.add(r)}else this.add(this.createRecord(t));return this},r.prototype.removeBy=function(t){this.remove(this.findAllBy(t))},r.prototype.removeRecord=function(t,e){this.removeBy(function(r){return r.get(t)===e})},r.prototype.removeById=function(t){this.remove(this.getById(t))},r.prototype.removeAt=function(t,e){this.remove(this.findAllAt(t,e))},r.prototype.removeAll=function(t){this.data.length>0&&(this.clear(),this.emit("datachanged",this),t||this.emit("removeall",this))},r.prototype.remove=function(t){var e,r,o,i,n,s;for(e=!1,s=Array.from(t),i=0,n=s.length;n>i;i++)o=s[i],o.unjoinStore(this),r=this.indexOf(o),this.data.erase(o),this.newRecords.erase(o),this.updatedRecords.erase(o),this.removedRecords.include(o),this.emit("remove",this,o,r),this.filtered&&this.getFilters().match(o)&&this.filteredData.erase(o),e=!0;e&&this.emit("datachanged",this)},r.prototype.clear=function(){var t,e,r,o;for(o=this.data,e=0,r=o.length;r>e;e++)t=o[e],t.unjoinStore(this);this.filtered&&this.filteredData.empty(),this.data.empty()},r.prototype.load=function(t,e){if(null==t&&(t={}),null==e&&(e=null),!this.proxy)throw new Error("Cant load data, proxy is missing in store");return t.once&&this.loaded?void miwo.async(function(t){return function(){return e?e(t,t.data,!0):void 0}}(this)):void(this.loading||(t.params=Object.merge({},this.params,t.params),t.offset=void 0!==t.offset?t.offset:(t.page?t.page-1:0)*this.pageSize,t.limit=t.limit||this.pageSize,t.filters=this.storeFilters?this.storeFilters.getAll():null,t.sorters=this.storeSorters?this.storeSorters.getAll():null,t.addRecords=t.addRecords||!1,t.recordFactory=this.bound("createRecord"),this.emit("beforeload",this,t),this.loading=!0,this.page=this.pageSize?Math.max(1,Math.ceil(t.offset/this.pageSize)+1):1,this.proxy.read(t,function(t){return function(r){var o,i,n;return i=r.getResponse(),o=r.getRecords(),n=r.wasSuccessful(),n&&t.loadRecords(o,!0),i&&(t.totalCount=i.total),t.loading=!1,t.loaded=!0,t.emit("load",t,o,n),e?e(t,o,n):void 0}}(this))))},r.prototype.reload=function(t){this.load({page:this.page},t)},r.prototype.loadPage=function(t,e){this.pageSize&&(this.page=Math.max(1,Math.min(t,Math.ceil(this.totalCount/this.pageSize))),this.load({page:this.page},e))},r.prototype.loadPrevPage=function(t){this.pageSize&&(this.page=Math.max(1,this.page-1),this.load({page:this.page},t))},r.prototype.loadNextPage=function(t){this.pageSize&&(this.page=Math.min(this.page+1,Math.ceil(this.totalCount/this.pageSize)),this.load({page:this.page},t))},r.prototype.loadNestedPage=function(t,e){"prev"===t?this.loadPrevPage(e):"next"===t&&this.loadNextPage(e)},r.prototype.resumeAutoSync=function(){this.autoSyncSuspended=!0},r.prototype.suspendAutoSync=function(){this.autoSyncSuspended=!1},r.prototype.sync=function(t){var e,r,o,i,n;null==t&&(t={}),this.proxy&&(o=this.getNewRecords(),n=this.getUpdatedRecords(),i=this.getRemovedRecords(),r={},e=!1,o.length>0&&(r.create={records:o,callback:this.createProxyCallback("onProxyCreateCallback",t)},e=!0),n.length>0&&(r.update={records:n,callback:this.createProxyCallback("onProxyUpdateCallback",t)},e=!0),i.length>0&&(r.destroy={records:i,callback:this.createProxyCallback("onProxyDestroyCallback",t)},e=!0),e?(r.preventSync=!1,this.emit("beforesync",r),r.preventSync||this.proxy.execute(r,{recordFactory:this.bound("createRecord")})):Type.isFunction(t)&&miwo.async(function(){return function(){return t()}}(this)))},r.prototype.createProxyCallback=function(t,e){return function(r){return function(o){if(r.emit("sync",r,o),o.wasSuccessful()){if(r.emit("success",r,o),r[t](),!Type.isObject(e))return e(r,o);if(e.success)return e.success(r,o)}else{if(r.emit("failure",r,o),!Type.isObject(e))return e(r,o);if(e.failure)return e.failure(r,o)}}}(this)},r.prototype.onProxyCreateCallback=function(){this.newRecords.empty(),this.onProxyCallback(),this.emit("created",this)},r.prototype.onProxyUpdateCallback=function(){this.updatedRecords.empty(),this.onProxyCallback(),this.emit("updated",this)},r.prototype.onProxyDestroyCallback=function(){this.removedRecords.empty(),this.onProxyCallback(),this.emit("destroyed",this)},r.prototype.onProxyCallback=function(){this.emit("synced",this),this.autoSyncReload&&this.reload()},r.prototype.getSorters=function(){return this.storeSorters||(this.storeSorters=new n(this)),this.storeSorters},r.prototype.getFilters=function(){return this.storeFilters||(this.storeFilters=new i(this)),this.storeFilters},r.prototype.afterEdit=function(t,e){var r,o,i,n;if(this.updatedRecords.include(t),this.proxy&&this.autoSync&&!this.autoSyncSuspended){for(i=0,n=e.length;n>i;i++)if(r=e[i],t.fields[r].persist){o=!0;break}o&&this.sync()}this.sortOnEdit&&!this.remoteSort&&this.storeSorters&&this.storeSorters.has()&&this.storeSorters.apply(!0),this.filterOnEdit&&!this.remoteFilter&&this.storeFilters&&this.storeFilters.has()&&this.storeFilters.apply(!0),this.emit("update",this,t,"edit",e)},r.prototype.afterReject=function(t){this.updatedRecords.erase(t),this.emit("update",this,t,"reject",null)},r.prototype.afterCommit=function(t){this.updatedRecords.erase(t),this.emit("update",this,t,"commit",null)},r}(Miwo.Object),r.exports=o},{"./StoreFilters":12,"./StoreSorters":14}],12:[function(t,e){var r,o;r=t("./Filter"),o=function(){function t(t){this.store=t,this.filters=[]}return t.prototype.filters=null,t.prototype.store=null,t.prototype.getAll=function(){return this.filters},t.prototype.clear=function(){this.filters.empty()},t.prototype.append=function(t){this.filters.push(t)},t.prototype.has=function(){return this.filters.length>0},t.prototype.add=function(t,e,o,i,n){var s,a,p;if(Type.isArray(t))for(a=0,p=t.length;p>a;a++)s=t[a],this.add(s);else this.append(Type.isInstance(t)?t:Type.isObject(t)?new r(t):new r({name:t,value:e,type:o,operation:i,params:n}));return this},t.prototype.filter=function(t,e,r,o,i){return this.clear(),t&&this.add(t,e,r,o,i),this.apply(),this},t.prototype.apply=function(t){var e,r,o,i;if(this.store.remoteFilter)this.store.load();else{for(this.store.filtered=this.filters.length>0,this.store.filteredData=[],i=this.store.data,r=0,o=i.length;o>r;r++)e=i[r],this.match(e)&&this.store.filteredData.push(e);t||this.store.emit("refresh",this.store)}return this.store.emit("filter",this.store,this.filters),this},t.prototype.match=function(t){var e,r,o,i;for(i=this.filters,r=0,o=i.length;o>r;r++)if(e=i[r],e.match(t)===!1)return!1;return!0},t}(),e.exports=o},{"./Filter":5}],13:[function(t,r){var o,i,n;o=t("./BaseManager"),i=t("./Store"),n=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype.create=function(t){var e;if(e=r.__super__.create.call(this,t),!e.isStore)throw new Error("Created store is not instance of Miwo.data.Store");return e.name||(e.name=t),e},r}(o),r.exports=n},{"./BaseManager":1,"./Store":11}],14:[function(t,e){var r,o;r=t("./Sorter"),o=function(){function t(t){this.store=t,this.sorters=[],this.comparator=this.createComparator(this)}return t.prototype.sorters=null,t.prototype.store=null,t.prototype.clear=function(){return this.sorters.empty(),this},t.prototype.has=function(){return this.sorters.length>0},t.prototype.getAll=function(){return this.sorters},t.prototype.set=function(t,e){var o,i;if(Type.isObject(t))for(i in t)o=t[i],this.set(i,o);else this.sorters.push(new r({name:t,dir:e}));return this},t.prototype.sort=function(t,e){return this.clear(),t&&this.set(t,e),this.apply(),this},t.prototype.apply=function(t){var e,r,o;return o=this.store,r=this.sorters,e=this.comparator,o.remoteSort?o.load():(o.sorted=r.length>0,o.data.sort(e),o.filteredData&&o.filteredData.sort(e),t||o.emit("refresh",o)),o.emit("sort",o,r),this},t.prototype.getInsertionIndex=function(t,e){var r,o,i,n,s;for(r=0,s=this.store.data,r=i=0,n=s.length;n>i;r=++i)if(o=s[r],e(o,t)>0)return r;return r},t.prototype.getIndex=function(t){return this.getInsertionIndex(t,this.comparator)},t.prototype.createComparator=function(t){return function(e,r){var o,i,n,s,a;if(t.sorters)for(a=t.sorters,n=0,s=a.length;s>n;n++)if(i=a[n],o=i.compare(e,r),-1===o||1===o)return o}},t}(),e.exports=o},{"./Sorter":10}],15:[function(t,e){var r;
r={stripRe:/[\$,%]/g,string:{type:"string",convert:function(t){var e;return e=this.nullable?null:"",void 0===t||null===t?e:String(t)}},"int":{type:"int",convert:function(t){return void 0!==t&&null!==t&&""!==t?parseInt(String(t).replace(r.stripRe,""),10):this.nullable?null:0}},"float":{type:"float",convert:function(t){return void 0!==t&&null!==t&&""!==t?parseFloat(String(t).replace(r.stripRe,""),10):this.nullable?null:0}},"boolean":{type:"boolean",convert:function(t){return!this.nullable||void 0!==t&&null!==t&&""!==t?t===!0||"true"===t||1===t:null}},date:{type:"date",convert:function(t){var e;return e=void 0,t?Type.isDate(t)?t:(e=Date.parse(t),e?new Date(e):null):null}},json:{type:"json",convert:function(t){return t?Type.isString(t)?JSON.decode(t):t:{}}},array:{type:"array",convert:function(t){return t?Type.isArray(t)?t:Type.isString(t)?t.split(";"):Array.from(t):null}}},e.exports=r},{}],16:[function(t){Miwo.data={Record:t("./Record"),Entity:t("./Entity"),Proxy:t("./Proxy"),Store:t("./Store"),Types:t("./Types"),Filter:t("./Filter"),Sorter:t("./Sorter")},Miwo.Store=Miwo.data.Store,Miwo.Record=Miwo.data.Record,Miwo.Entity=Miwo.data.Entity,Miwo.Proxy=Miwo.data.Proxy,miwo.registerExtension("miwo-data",t("./DiExtension"))},{"./DiExtension":2,"./Entity":3,"./Filter":5,"./Proxy":7,"./Record":9,"./Sorter":10,"./Store":11,"./Types":15}]},{},[16])}();